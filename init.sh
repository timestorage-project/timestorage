#!/bin/bash

# Start dfx in the background
dfx start --background

# Wait a few seconds for dfx to start properly
sleep 5

dfx deploy

# Insert the UUID structure
dfx canister call timestorage_backend insertUUIDStructure '( "uuid-dummy", "{\"schema\":{\"$schema\":\"https://json-schema.org/draft/2020-12/schema\",\"$id\":\"https://example.com/my-data-wizard-schema.json\",\"title\":\"Data & Wizard Structure Schema\",\"type\":\"object\",\"description\":\"A schema that validates sections of type 'data' or 'wizard'.\",\"patternProperties\":{\"^.+$\":{\"$ref\":\"#/$defs/Section\"}},\"additionalProperties\":false,\"$defs\":{\"Section\":{\"type\":\"object\",\"required\":[\"id\",\"title\",\"description\",\"type\"],\"properties\":{\"id\":{\"type\":\"string\",\"description\":\"Unique identifier of this section.\"},\"title\":{\"type\":\"string\",\"description\":\"i18n key for the section title.\"},\"description\":{\"type\":\"string\",\"description\":\"i18n key for the section description.\"},\"type\":{\"type\":\"string\",\"enum\":[\"data\",\"wizard\"],\"description\":\"Defines whether this section is a 'data' section or a 'wizard' section.\"},\"icon\":{\"type\":\"string\",\"description\":\"Optional icon for visual representation.\"},\"children\":{\"type\":\"array\",\"description\":\"List of data items if this section is type 'data'.\",\"items\":{\"$ref\":\"#/$defs/DataItem\"}},\"questions\":{\"type\":\"array\",\"description\":\"List of wizard questions if this section is type 'wizard'.\",\"items\":{\"$ref\":\"#/$defs/WizardQuestion\"}}},\"allOf\":[{\"if\":{\"properties\":{\"type\":{\"const\":\"data\"}}},\"then\":{\"required\":[\"children\"],\"properties\":{\"questions\":{\"maxItems\":0}}}},{\"if\":{\"properties\":{\"type\":{\"const\":\"wizard\"}}},\"then\":{\"required\":[\"questions\"],\"properties\":{\"children\":{\"maxItems\":0}}}}]},\"DataItem\":{\"type\":\"object\",\"required\":[\"label\",\"value\"],\"properties\":{\"icon\":{\"type\":\"string\",\"description\":\"Optional icon (emoji or string) to display next to the data.\"},\"label\":{\"type\":\"string\",\"description\":\"i18n key describing what this field represents.\"},\"value\":{\"type\":\"string\",\"description\":\"Reference or actual string to store the data.\"}},\"additionalProperties\":false},\"WizardQuestion\":{\"type\":\"object\",\"required\":[\"id\",\"type\",\"question\"],\"properties\":{\"id\":{\"type\":\"string\",\"description\":\"Unique identifier for this question.\"},\"type\":{\"type\":\"string\",\"enum\":[\"text\",\"select\",\"multiselect\",\"photo\",\"multiphoto\"],\"description\":\"Question type.\"},\"question\":{\"type\":\"string\",\"description\":\"i18n key for the question text.\"},\"options\":{\"type\":\"array\",\"description\":\"List of choices (only required for 'select' or 'multiselect').\",\"items\":{\"type\":\"string\"}},\"refId\":{\"type\":\"string\",\"description\":\"Pointer to the data field where this answer should be stored.\"},\"conditions\":{\"type\":\"array\",\"description\":\"Optional array describing conditional logic for this question.\",\"items\":{\"$ref\":\"#/$defs/Condition\"}}},\"allOf\":[{\"if\":{\"properties\":{\"type\":{\"enum\":[\"select\",\"multiselect\"]}}},\"then\":{\"required\":[\"options\"]}}],\"additionalProperties\":false},\"Condition\":{\"type\":\"object\",\"required\":[\"questionId\",\"operator\",\"value\",\"action\"],\"properties\":{\"questionId\":{\"type\":\"string\",\"description\":\"ID of another question on which this question depends.\"},\"operator\":{\"type\":\"string\",\"enum\":[\"equals\",\"notEquals\",\"in\",\"notIn\",\"greaterThan\",\"lessThan\"],\"description\":\"Operator to evaluate.\"},\"value\":{\"type\":[\"string\",\"number\",\"boolean\",\"array\"],\"description\":\"Value to compare against the answer of questionId.\"},\"action\":{\"type\":\"string\",\"enum\":[\"show\",\"hide\",\"enable\",\"disable\",\"require\",\"optional\"],\"description\":\"Action to perform if condition is met.\"}},\"additionalProperties\":false}}},\"data\":{\"productInfo\":{\"id\":\"product-info\",\"title\":\"PRODUCT_INFO_TITLE\",\"description\":\"PRODUCT_INFO_DESCRIPTION\",\"type\":\"data\",\"icon\":\"info\",\"children\":[{\"icon\":\"üìè\",\"label\":\"DIMENSIONS_LABEL\",\"value\":\"#/values/productInfo/dimensions\"},{\"icon\":\"üî¢\",\"label\":\"MODEL_NUMBER_LABEL\",\"value\":\"#/values/productInfo/modelNumber\"},{\"icon\":\"üèóÔ∏è\",\"label\":\"MATERIAL_TYPE_LABEL\",\"value\":\"#/values/productInfo/materialType\"},{\"icon\":\"ü™ü\",\"label\":\"GLASS_TYPE_LABEL\",\"value\":\"#/values/productInfo/glassType\"},{\"icon\":\"‚ö°\",\"label\":\"ENERGY_RATING_LABEL\",\"value\":\"#/values/productInfo/energyRating\"},{\"icon\":\"üìÖ\",\"label\":\"MANUFACTURING_DATE_LABEL\",\"value\":\"#/values/productInfo/manufacturingDate\"},{\"icon\":\"üî¢\",\"label\":\"SERIAL_NUMBER_LABEL\",\"value\":\"#/values/productInfo/serialNumber\"},{\"icon\":\"üìã\",\"label\":\"INSTALLATION_STATUS_LABEL\",\"value\":\"#/values/productInfo/installationStatus\"},{\"icon\":\"ü™ü\",\"label\":\"WINDOW_TYPE_LABEL\",\"value\":\"#/values/productInfo/windowType\"}]},\"installationProcess\":{\"id\":\"installation-process\",\"title\":\"INSTALLATION_PROCESS_TITLE\",\"description\":\"INSTALLATION_PROCESS_DESCRIPTION\",\"type\":\"data\",\"icon\":\"download\",\"children\":[{\"icon\":\"üìÖ\",\"label\":\"SCHEDULED_DATE_LABEL\",\"value\":\"#/values/installationProcess/scheduledDate\"},{\"icon\":\"üë§\",\"label\":\"INSTALLER_LABEL\",\"value\":\"#/values/installationProcess/installer\"},{\"icon\":\"‚è±Ô∏è\",\"label\":\"DURATION_LABEL\",\"value\":\"#/values/installationProcess/duration\"},{\"icon\":\"üìã\",\"label\":\"STATUS_LABEL\",\"value\":\"#/values/installationProcess/status\"},{\"icon\":\"üîß\",\"label\":\"TOOLS_REQUIRED_LABEL\",\"value\":\"#/values/installationProcess/toolsRequired\"},{\"icon\":\"üë§\",\"label\":\"INSTALLER_NAME_LABEL\",\"value\":\"#/values/installationProcess/installerName\"},{\"icon\":\"üß∞\",\"label\":\"TOOLS_NEEDED_LABEL\",\"value\":\"#/values/installationProcess/toolsNeeded\"},{\"icon\":\"üìù\",\"label\":\"INSTALLATION_NOTES_LABEL\",\"value\":\"#/values/installationProcess/installationNotes\"},{\"icon\":\"üì∑\",\"label\":\"WINDOW_PHOTO_LABEL\",\"value\":\"#/values/installationProcess/windowPhoto\"},{\"icon\":\"üì∑\",\"label\":\"INSTALLATION_PHOTOS_LABEL\",\"value\":\"#/values/installationProcess/installationPhotos\"}]},\"maintenanceLog\":{\"id\":\"maintenance-log\",\"title\":\"MAINTENANCE_LOG_TITLE\",\"description\":\"MAINTENANCE_LOG_DESCRIPTION\",\"type\":\"data\",\"icon\":\"build\",\"children\":[{\"icon\":\"üîß\",\"label\":\"LAST_SERVICE_LABEL\",\"value\":\"#/values/maintenanceLog/lastService\"},{\"icon\":\"üìù\",\"label\":\"SERVICE_TYPE_LABEL\",\"value\":\"#/values/maintenanceLog/serviceType\"},{\"icon\":\"üë§\",\"label\":\"TECHNICIAN_LABEL\",\"value\":\"#/values/maintenanceLog/technician\"},{\"icon\":\"üìÖ\",\"label\":\"NEXT_SERVICE_DUE_LABEL\",\"value\":\"#/values/maintenanceLog/nextServiceDue\"}]},\"startInstallation\":{\"id\":\"wizard\",\"title\":\"START_INSTALLATION_TITLE\",\"description\":\"START_INSTALLATION_DESCRIPTION\",\"type\":\"wizard\",\"icon\":\"build\",\"questions\":[{\"id\":\"installer_name\",\"type\":\"text\",\"question\":\"INSTALLER_NAME_QUESTION\",\"refId\":\"#/values/installationProcess/installerName\"},{\"id\":\"window_type\",\"type\":\"select\",\"question\":\"WINDOW_TYPE_QUESTION\",\"options\":[\"Single Hung\",\"Double Hung\",\"Casement\",\"Sliding\"],\"refId\":\"#/values/productInfo/windowType\"},{\"id\":\"tools_needed\",\"type\":\"multiselect\",\"question\":\"TOOLS_NEEDED_QUESTION\",\"options\":[\"Drill\",\"Level\",\"Tape Measure\",\"Screwdriver\",\"Caulk Gun\"],\"refId\":\"#/values/installationProcess/toolsNeeded\"},{\"id\":\"installation_notes\",\"type\":\"text\",\"question\":\"INSTALLATION_NOTES_QUESTION\",\"refId\":\"#/values/installationProcess/installationNotes\"},{\"id\":\"window_photo\",\"type\":\"photo\",\"question\":\"WINDOW_PHOTO_QUESTION\",\"refId\":\"#/values/installationProcess/windowPhoto\"},{\"id\":\"installation_photos\",\"type\":\"multiphoto\",\"question\":\"INSTALLATION_PHOTOS_QUESTION\",\"refId\":\"#/values/installationProcess/installationPhotos\"}]}}}" )'